@using Cuentos.Models
@{
    ViewBag.Title = "Editar Cuento";
    var imageCategoriesList = (List<ImageCategory>)ViewBag.ImageCategories;
}
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head><div class="row pick">
    <div class="col-md-2 col-md-offset-5">
        <br /><br /><br /><br />
        <h1 style="color: forestgreen;"><input type="radio" name="storyType" value="Story">Text</h1><br />
        <h1 style="color: forestgreen;"><input type="radio" name="storyType" value="Video">Video</h1><br />
    </div>
</div>
<iframe class="editor" id="editor"></iframe>
@Html.Partial("_Builder")
<script>

    $(document).ready(function ()
    {
        $(".editor").hide();
        $(".textEditor").hide();

    });
    $('input:radio[name="storyType"]').change(
    function(){
        if (this.checked && this.value == 'Story') {
            // note that, as per comments, the 'changed'
            // <input> will *always* be checked, as the change
            // event only fires on checking an <input>, not
            // on un-checking it.
            // append goes here
            
            $( ".editor" ).hide();
            $(".textEditor").show();
            $(".pick").hide();

        }else{
            if(this.checked && this.value == 'Video')
            {
                $( ".textEditor" ).hide();
                $(".editor").show();
                console.log("Logging in...");
                $.ajax(
                "https://awstest.wevideo.com/api/3/sso/login/" + "@ViewBag.Token",
                {
                    success: function () {
                        console.log("Logged in");
                        $("iframe#editor").attr("src", "https://awstest.wevideo.com/c/CuentaCuentos");
                        $("iframe#editor").css("width", "100%");

                        $("iframe#editor").css("height", "1000px");
                        $(".pick").hide();
                    },
                    error: function () {
                        console.log("Failed login");
                    },
                    xhrFields: { withCredentials: true }
                }
                );



            }

        }
    });
</script>

@section scripts{
    <script>var storyId = @Model.Id;</script>
    <script src="~/Scripts/vendor/handlebars-v2.0.0.js"></script>
    <script src="~/Scripts/vendor/underscore-min.js"></script>
    <script src="~/Scripts/vendor/backbone-min.js"></script>
    <script src="~/Scripts/vendor/ckeditor/ckeditor.js"></script>
    <script src="~/Scripts/vendor/ckeditor/adapters/jquery.js"></script>
    @*<script src="~/Scripts/vendor/slick/slick.min.js"></script>*@
    <script src="~/Scripts/vendor/jquery-sortable-min.js"></script>
    <script src="~/Scripts/vendor/fancybox/jquery.fancybox.js"></script>
    <script src="~/Scripts/vendor/jquery.loadingdotdotdot.js"></script>
    

    <script src="~/Scripts/vendor/jquery.ui.widget.js"></script>
    <script src="~/Scripts/vendor/jquery.iframe-transport.js"></script>
    <script src="~/Scripts/vendor/jquery.fileupload.js"></script>

    <script src="~/Scripts/builder.js"></script>
    <script src="~/Scripts/builder-models.js"></script>
    <script src="~/Scripts/builder-collections.js"></script>
    <script src="~/Scripts/builder-views.js"></script>

    <script>
        App.StoryJson = @Html.Raw(Json.Encode(Model));
        App.CategoriesJson = @Html.Raw(Json.Encode(ViewBag.Categories));
        App.GradesJson = @Html.Raw(Json.Encode(Enum.GetNames(typeof(Grade))));
        App.PageTypesJson = @Html.Raw(Json.Encode(ViewBag.PageTypes));
        App.ImagesJson = @Html.Raw(Json.Encode(ViewBag.Images));
        App.ImagesCategoriesJson = @Html.Raw(Json.Encode(ViewBag.ImageCategories));
        App.UserId = '@HttpContext.Current.User.Identity.Name';
    //console.table(App.PageTypesJson);
    </script>
    <script src="~/Scripts/builder-main.js"></script>

    <script>
        Handlebars.registerHelper('isChecked', function(selectedArray, currentId) {
            var result = '';
            $.each(selectedArray, function(i,e){
                if(e.Id == currentId){
                    result = 'checked';
                }
            });
            return result;
        });

        Handlebars.registerHelper('showDeleteButton', function(index) {
            
            var result = '';            
            if(index > 1){
                result = '<div class="delete"></div>';
            }
            
            return result;
        });
    </script>

}
